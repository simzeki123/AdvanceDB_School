set serveroutput on;
set linesize 140;
set pagesize 50;

-- Top 5 Most popular author based on number of times books were borrowed


CREATE OR REPLACE PROCEDURE popular_author(year NUMBER) AS

    v_totalborrowing    number(5);
    v_authorName        authors.name%TYPE;

    select  DISTINCT book_authors.AuthorID,authors.name,count(borrow_details.borrowingsID) AS FREQUENCY
    FROM book_authors
    INNER JOIN borrow_details
    ON book_authors.bookID = borrow_details.bookID
    INNER JOIN authors
    ON book_authors.AuthorID = authors.AuthorID
    GROUP BY authors.name , book_authors.AuthorID
    ORDER BY count(borrow_details.borrowingsID) DESC;